<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="main">

	<!-- 배너 목록 조회 활성(Y) + 마감일 유효 배너 상위 N개 -->
	<select id="bannerList" parameterType="int"
		resultType="AdminImageDTO">
    <![CDATA[
    SELECT 
    ai.ADMIN_IMAGE_NUMBER,
    ai.ADMIN_IMAGE_SYSTEM_NAME,
    ai.ADMIN_IMAGE_ORIGINAL_NAME,
    ai.ADMIN_NUMBER,
    ai.POST_NUMBER,
    p.POST_TITLE
	FROM 
    TBL_ADMIN_IMAGE ai
	JOIN 
    TBL_POST p ON ai.POST_NUMBER = p.POST_NUMBER
	WHERE 
    p.POST_TITLE LIKE '%이벤트%'
    ]]>
	</select>

	<!-- 가게 목록 조회 -->
	<select id="storeList" resultType="MainStoreListDTO">
		<![CDATA[
		SELECT
		S.STORE_NAME,
		S.STORE_OPEN_TIME,
		S.STORE_CLOSE_TIME,
		I.ITEM_NAME,
		I.ITEM_PRICE,
		II.ITEM_IMAGE_NUMBER,
		II.ITEM_IMAGE_SYSTEM_NAME,
		II.ITEM_IMAGE_ORIGINAL_NAME,
		I.ITEM_NUMBER
		FROM
		TBL_STORE S
		JOIN
		TBL_ITEM I ON S.BUSINESS_NUMBER = I.BUSINESS_NUMBER
		JOIN
		TBL_ITEM_IMAGE II ON I.ITEM_NUMBER = II.ITEM_NUMBER
		WHERE
		I.ITEM_SELL_STATE = 'Y'
		AND I.ITEM_TYPE = 'FOOD'
		AND ROWNUM <= 8
		ORDER BY I.ITEM_NUMBER DESC
	    ]]>
	</select>

	<!-- 재료 목록 조회 -->
	<select id="ingredientList" resultType="ItemWithImgDTO">
    <![CDATA[
    	SELECT II.ITEM_IMAGE_SYSTEM_NAME, I.ITEM_NUMBER, I.ITEM_NAME, I.ITEM_PRICE
    	FROM TBL_ITEM_IMAGE II
    	JOIN TBL_ITEM I ON II.ITEM_NUMBER = I.ITEM_NUMBER
    	WHERE I.ITEM_TYPE = 'INGREDIENT'
      	AND ROWNUM <= 4
      	ORDER BY I.ITEM_NUMBER DESC
    	]]>
	</select>

	<!-- 레시피게시판 목록 조희 -->
	<select id="recipeList" resultType="PostDTO">
 <![CDATA[
		SELECT * FROM (
    	SELECT SUBQ.*, ROWNUM AS RNUM FROM (
        SELECT 
        P.POST_NUMBER AS postNumber,
        P.POST_TITLE AS postTitle,
        P.POST_CREATED_DATE AS postCreatedDate,
        P.POST_VIEW_COUNT AS postViewCount,
        P.POST_LIKE_COUNT AS postLikeCount,
        P.POST_TYPE AS postType,
        P.MEMBER_NUMBER AS memberNumber,
        M.MEMBER_ID AS memberId
        FROM TBL_POST P
        JOIN TBL_MEMBER M ON P.MEMBER_NUMBER = M.MEMBER_NUMBER
        WHERE P.POST_TYPE = 'RECIPE' 
        AND P.POST_DELETE_STATE = 'N'
        ORDER BY P.POST_CREATED_DATE DESC
    	) SUBQ
    	WHERE ROWNUM <= 8
		)
		]]>

	</select>


</mapper>