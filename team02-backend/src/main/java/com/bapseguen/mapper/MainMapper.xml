<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="main">

	<!-- 배너 목록 조회 활성(Y) + 마감일 유효 배너 상위 N개 -->
	<select id="bannerList" parameterType="int"
		resultType="BannerDTO">
    <![CDATA[
    SELECT * FROM (
      SELECT
        b.BANNER_NUMBER           AS bannerNumber,
        b.BANNER_TITLE            AS bannerTitle,
        b.ADMIN_IMAGE_NUMBER      AS imageNumber,
        TO_CHAR(b.BANNER_END_DATE, 'YYYY-MM-DD') AS bannerEndDate,
        CASE b.BANNER_IS_ACTIVE WHEN 'Y' THEN 1 ELSE 0 END AS bannerIsActive,
        ai.ADMIN_IMAGE_SYSTEM_NAME    AS adminImageSystemName,
        ai.ADMIN_IMAGE_ORIGINAL_NAME  AS adminImageOriginalName
      FROM TBL_BANNER b
      JOIN TBL_ADMIN_IMAGE ai
        ON ai.ADMIN_IMAGE_NUMBER = b.ADMIN_IMAGE_NUMBER
      WHERE b.BANNER_IS_ACTIVE = 'Y'
        AND b.BANNER_END_DATE >= TRUNC(SYSDATE)
      ORDER BY b.BANNER_CREATED_DATE DESC NULLS LAST, b.BANNER_NUMBER DESC
    )
    WHERE ROWNUM <= #{limit}
    ]]>
	</select>

	<!-- 가게 목록 조회 -->
	<select id="storeList" resultType="MainStoreListDTO">
		<![CDATA[
		SELECT
		S.STORE_NAME,
		S.STORE_OPEN_TIME,
		S.STORE_CLOSE_TIME,
		I.ITEM_NAME,
		I.ITEM_PRICE,
		II.ITEM_IMAGE_NUMBER,
		II.ITEM_IMAGE_SYSTEM_NAME,
		II.ITEM_IMAGE_ORIGINAL_NAME,
		I.ITEM_NUMBER
		FROM
		TBL_STORE S
		JOIN
		TBL_ITEM I ON S.BUSINESS_NUMBER = I.BUSINESS_NUMBER
		JOIN
		TBL_ITEM_IMAGE II ON I.ITEM_NUMBER = II.ITEM_NUMBER
		WHERE
		I.ITEM_SELL_STATE = 'Y'
		AND I.ITEM_TYPE = 'FOOD'
		AND ROWNUM <= 8
		ORDER BY I.ITEM_NUMBER DESC
	    ]]>
	</select>

	<!-- 재료 목록 조회 -->
	<select id="ingredientList" resultType="ItemWithImgDTO">
    <![CDATA[
    	SELECT II.ITEM_IMAGE_SYSTEM_NAME, I.ITEM_NUMBER, I.ITEM_NAME, I.ITEM_PRICE
    	FROM TBL_ITEM_IMAGE II
    	JOIN TBL_ITEM I ON II.ITEM_NUMBER = I.ITEM_NUMBER
    	WHERE I.ITEM_TYPE = 'INGREDIENT'
      	AND ROWNUM <= 4
      	ORDER BY I.ITEM_NUMBER DESC
    	]]>
	</select>

	<!-- 레시피게시판 목록 조희 -->
	<select id="recipeList" resultType="PostDTO">
		<![CDATA[
		SELECT
		POST_TITLE,POST_CREATED_DATE,POST_VIEW_COUNT,POST_TYPE,
		TO_CHAR(POST_CREATED_DATE, 'YYYY-MM-DD') AS postCreatedDate
		FROM
		TBL_POST
		WHERE POST_TYPE = 'RECIPE'
		AND ROWNUM <= 8 
		ORDER BY POST_CREATED_DATE DESC
		]]>
	</select>

</mapper>